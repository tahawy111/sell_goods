<%- include('./partials/head.ejs') %>

<div
  style="height: 100vh"
  class="d-flex justify-content-center align-items-center"
>
  <h1>ÙÙ‚Ø· Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ùˆ Ø§Ø¹Ù…Ù„ scan ğŸ“¡</h1>
</div>
<a class="d-none barcode-handle-details" href=""></a>

<script>
  const barcodeHandleSell = document.querySelector(".barcode-handle-sell");
  const dealerBarcodeHandle = document.querySelector(`input[name="barcode"]`);
  const barcodeForm = document.querySelector("form");
  let barcode = "";
  let interval;

  document.addEventListener("keydown", (evt) => {
    if (interval) {
      clearInterval(interval);
    }

    if (evt.code == "Enter") {
      if (barcode) handleBarcode(barcode);
      barcode = "";
      return;
    }

    if (evt.code != "Shift") barcode += evt.key;

    interval = setInterval(() => {
      barcode = "";
    }, 20);

    function handleBarcode(scanned_barcode) {
      if (barcodeHandleSell) {
        barcodeHandleSell.href = `/cart2/${scanned_barcode}`;
        barcodeHandleSell.click();
      } else {
        dealerBarcodeHandle.value = scanned_barcode;
        barcodeForm.submit();
      }
    }
  });
</script>

<%- include('./partials/footer.ejs') %>
